
CREATE DATABASE EmployeeDB;
USE EmployeeDB;


CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);


CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PLOC VARCHAR(50),
    PNAME VARCHAR(50)
);


CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);


INSERT INTO DEPT VALUES
(10, 'IT', 'Bengaluru'),
(20, 'HR', 'Hyderabad'),
(30, 'Finance', 'Mysuru'),
(40, 'Sales', 'Chennai'),
(50, 'Admin', 'Mumbai'),
(60, 'R&D', 'Pune');

INSERT INTO EMPLOYEE VALUES
(1001, 'Ravi', NULL, '2020-01-15', 55000, 10),
(1002, 'Meena', 1001, '2021-03-10', 47000, 20),
(1003, 'Kiran', 1001, '2022-02-20', 52000, 30),
(1004, 'Anita', 1002, '2019-11-05', 60000, 40),
(1005, 'Rohit', 1003, '2023-05-15', 40000, 50),
(1006, 'Divya', 1001, '2021-08-12', 45000, 60);


INSERT INTO PROJECT VALUES
(1, 'Bengaluru', 'AI Development'),
(2, 'Hyderabad', 'Web Portal'),
(3, 'Mysuru', 'Finance Tracker'),
(4, 'Chennai', 'CRM System'),
(5, 'Mumbai', 'Admin Automation'),
(6, 'Pune', 'Research System');


INSERT INTO ASSIGNED_TO VALUES
(1001, 1, 'Manager'),
(1002, 2, 'Developer'),
(1003, 3, 'Analyst'),
(1004, 4, 'Tester'),
(1005, 5, 'Support'),
(1006, 6, 'Researcher'),
(1003, 1, 'Consultant'),
(1002, 3, 'Analyst');

INSERT INTO INCENTIVES VALUES
(1001, '2024-06-10', 5000),
(1002, '2024-07-12', 3000),
(1004, '2024-08-15', 2500),
(1006, '2024-09-25', 4000);


SELECT DISTINCT A.EMPNO
FROM ASSIGNED_TO A
JOIN PROJECT P ON A.PNO = P.PNO
WHERE P.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');


SELECT E.EMPNO
FROM EMPLOYEE E
WHERE E.EMPNO NOT IN (SELECT EMPNO FROM INCENTIVES);


SELECT E.EMPNO, E.ENAME, D.DNAME, A.JOB_ROLE, D.DLOC AS Dept_Location, P.PLOC AS Project_Location
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
JOIN PROJECT P ON A.PNO = P.PNO
WHERE D.DLOC = P.PLOC;



SELECT E1.ENAME AS MANAGER_NAME
FROM EMPLOYEE E1
JOIN EMPLOYEE E2 ON E1.EMPNO = E2.MGR_NO
GROUP BY E1.ENAME
HAVING COUNT(E2.EMPNO) = (
    SELECT MAX(CNT)
    FROM (
        SELECT COUNT(E3.EMPNO) AS CNT
        FROM EMPLOYEE E3
        WHERE E3.MGR_NO IS NOT NULL
        GROUP BY E3.MGR_NO
    ) AS TEMP
);



SELECT DISTINCT M.ENAME AS MANAGER_NAME
FROM EMPLOYEE M
JOIN EMPLOYEE E ON M.EMPNO = E.MGR_NO
GROUP BY M.EMPNO, M.ENAME, M.SAL
HAVING M.SAL > AVG(E.SAL);



SELECT DISTINCT E.ENAME AS SECOND_TOP_MANAGER, D.DNAME
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE E.MGR_NO IN (
    SELECT EMPNO FROM EMPLOYEE WHERE MGR_NO IS NULL
);



SELECT E.*
FROM EMPLOYEE E
WHERE E.EMPNO = (
    SELECT EMPNO
    FROM INCENTIVES
    WHERE MONTH(INCENTIVE_DATE) = 1 AND YEAR(INCENTIVE_DATE) = 2019
    ORDER BY INCENTIVE_AMOUNT DESC
    LIMIT 1 OFFSET 1
);


SELECT E.ENAME AS EMPLOYEE_NAME, M.ENAME AS MANAGER_NAME, D.DNAME AS DEPARTMENT
FROM EMPLOYEE E
JOIN EMPLOYEE M ON E.MGR_NO = M.EMPNO
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE E.DEPTNO = M.DEPTNO;



